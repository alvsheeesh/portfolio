---
import BaseLayout from "../layouts/BaseLayout.astro";
import projects from "../data/projects.json";

// Utilidad para alternar el layout (texto|preview)
const isEven = (n) => n % 2 === 0;
---

<BaseLayout title="Projects • Álvaro Silva" description="Selected work, labs, and demos.">
  <section class="space-y-8">
    <!-- Header -->
    <header class="space-y-2">
      <h1
        class="text-3xl sm:text-4xl font-bold tracking-tight text-[color:var(--text)]"
        data-i18n="projects.title"
      >
        Projects
      </h1>
      <p
        class="text-[color:var(--muted)] max-w-3xl"
        data-i18n="projects.intro"
      >
        A curated list of academic projects and labs. Each card is sourced from projects.json and translated via keys.
      </p>
    </header>

    <!-- Si no hay proyectos -->
    {projects.length === 0 && (
      <p class="text-[color:var(--muted)]" data-i18n="projects.empty">
        No projects to show yet.
      </p>
    )}

    <!-- BLOQUES alternos -->
    <div class="space-y-6">
      {projects.map((p, idx) => {
        const even = isEven(idx);
        const leftColOrder = even ? "" : "md:order-2";
        const rightColOrder = even ? "" : "md:order-1";

        return (
          <article
            class="group rounded-2xl border border-border bg-card p-4 sm:p-5 transition-all"
          >
            <!-- Grid: alterna orden en md+ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 items-center">
              <!-- Columna 1: Descripción -->
              <div class={leftColOrder}>
                <!-- Título -->
                <h2
                  class="text-xl font-semibold text-[color:var(--text)]"
                  data-i18n={p.titleKey}
                >
                  [{p.titleKey}]
                </h2>

                <!-- Estado + Tags -->
                <div class="mt-2 flex flex-wrap items-center gap-2">
                  <span class="pill pill-accent" data-i18n={p.statusKey}>
                    [{p.statusKey}]
                  </span>
                  {p.tags && p.tags.map((t) => (
                    <span class="pill">#{t}</span>
                  ))}
                </div>

                <!-- Descripción -->
                <p class="mt-3 text-[color:var(--muted)]" data-i18n={p.descKey}>
                  [{p.descKey}]
                </p>

                <!-- Enlaces opcionales -->
                {p.links && p.links.length > 0 && (
                  <div class="flex flex-wrap gap-2 pt-3">
                    {p.links.map((l) => (
                      <a
                        href={l.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="btn px-3 py-2"
                        data-i18n={l.labelKey}
                        data-i18n-attr="title: cta.open"
                      >
                        [{l.labelKey}]
                      </a>
                    ))}
                  </div>
                )}
              </div>

              <!-- Columna 2: Preview -->
              <div class={rightColOrder}>
                <a
                  href={p.previewUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block overflow-hidden rounded-xl border border-[color:var(--border)] transition duration-150"
                  data-i18n-attr="title: projects.preview.open"
                >
                  <img
                    src={p.image}
                    alt=""
                    class="w-full h-auto object-cover transition duration-150"
                    loading="lazy"
                    data-i18n-attr={`alt: ${p.imageAltKey}`}
                  />
                </a>
              </div>
            </div>
          </article>
        );
      })}
    </div>
  </section>

  <style>
    /* Hover: realce del bloque */
    article.group {
      transition: transform 150ms ease, border-color 150ms ease, box-shadow 150ms ease;
    }
    article.group:hover {
      transform: translateY(-1px);
      border-color: var(--accent);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
    }
    /* Imagen: sutil zoom */
    article.group:hover img {
      transform: scale(1.01);
    }

    /* Píldoras para estado y tags */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.6rem;
      border-radius: 9999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: color-mix(in srgb, var(--surface) 90%, transparent 10%);
      font-size: 0.75rem;
      line-height: 1;
      white-space: nowrap;
    }
    .pill-accent {
      border-color: var(--accent);
      color: var(--text);
      background: color-mix(in srgb, var(--surface) 70%, var(--accent) 10%);
    }
  </style>
</BaseLayout>
``